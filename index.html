<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocuSign JSON to PDF Converter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Load signature libraries for real signature field support -->
    <script type="module" id="signature-libs">
        // Import signature libraries for real signature field functionality
        import { PdfDigitalSigner } from "https://esm.sh/sign-pdf-lib@2.0.3?bundle&deps=pdf-lib@1.17.1,node-forge@1.3.1";
        import { pdflibAddPlaceholder } from "https://esm.sh/@signpdf/placeholder-pdf-lib@3.2.6";
        
        // Make signature libraries globally available for the converter
        window.PdfDigitalSigner = PdfDigitalSigner;
        window.pdflibAddPlaceholder = pdflibAddPlaceholder;
        
        console.log('Real signature field libraries loaded successfully');
    </script>
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 0;
        }
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        .upload-area:hover {
            border-color: #667eea;
            background: #e3f2fd;
        }
        .upload-area.dragover {
            border-color: #667eea;
            background: #e3f2fd;
            transform: scale(1.02);
        }
        .feature-card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .loading {
            display: none;
        }
        .file-info {
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }
        .alert {
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container">
            <div class="row justify-content-center text-center">
                <div class="col-lg-8">
                    <h1 class="display-4 fw-bold mb-4">
                        <i class="bi bi-file-earmark-pdf me-3"></i>
                        DocuSign JSON to PDF Converter
                    </h1>
                    <p class="lead mb-4">
                        Convert your DocuSign template JSON files into clean, fillable PDFs with proper Adobe AcroForm field types.
                        Automatically maps DocuSign fields to appropriate PDF field types including digital signatures, date fields, text fields, and checkboxes.
                    </p>
                    <div class="alert alert-info d-inline-block">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Note:</strong> This is a client-side converter. Your files are processed locally and never uploaded to any server.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Upload Form -->
                <div class="card shadow-lg border-0">
                    <div class="card-body p-4">
                        <h3 class="card-title text-center mb-4">
                            <i class="bi bi-upload me-2"></i>
                            Upload Your DocuSign JSON File
                        </h3>
                        
                        <!-- Alert Messages -->
                        <div id="alertContainer"></div>
                        
                        <!-- Real Signature Fields Notification -->
                        <div class="alert alert-info alert-dismissible fade show" role="alert">
                            <i class="bi bi-patch-check-fill me-2"></i>
                            <strong>New Feature:</strong> Real Signature Fields! This converter now creates actual clickable signature fields that Adobe Acrobat/Reader recognizes. 
                            Users can sign documents digitally using their certificates or draw signatures directly in PDF viewers.
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>

                        <form id="uploadForm">
                            <!-- File Upload Area -->
                            <div class="upload-area" id="uploadArea">
                                <i class="bi bi-cloud-upload fa-3x text-muted mb-3" style="font-size: 3rem;"></i>
                                <h5 class="mb-3">Drag & Drop your JSON file here</h5>
                                <p class="text-muted mb-3">or click to browse</p>
                                <input type="file" id="fileInput" accept=".json" class="d-none" required>
                                <button type="button" class="btn btn-outline-primary" id="chooseFileBtn">
                                    <i class="bi bi-folder2-open me-2"></i>
                                    Choose File
                                </button>
                                <div id="fileInfo" class="file-info" style="display: none;">
                                    <i class="bi bi-file-earmark-code me-2"></i>
                                    <span id="fileName"></span>
                                    <small class="text-muted d-block" id="fileSize"></small>
                                </div>
                            </div>

                            <!-- Conversion Options -->
                            <div class="mt-4">
                                <h5 class="mb-3">
                                    <i class="bi bi-gear me-2"></i>
                                    Conversion Options
                                </h5>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="mask_header_height" class="form-label">
                                            <i class="bi bi-eye-slash me-1"></i>
                                            Header Mask Height (points)
                                        </label>
                                        <input type="number" class="form-control" id="mask_header_height" 
                                               value="24" min="0" step="0.1">
                                        <div class="form-text">Height to mask from top (default: 24 to hide DocuSign envelope ID)</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="mask_footer_height" class="form-label">
                                            <i class="bi bi-eye-slash me-1"></i>
                                            Footer Mask Height (points)
                                        </label>
                                        <input type="number" class="form-control" id="mask_footer_height" 
                                               value="0" min="0" step="0.1">
                                        <div class="form-text">Height to mask from bottom (default: 0)</div>
                                    </div>
                                </div>

                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <label for="exclude_doc_ids" class="form-label">
                                            <i class="bi bi-funnel me-1"></i>
                                            Exclude Document IDs
                                        </label>
                                        <input type="text" class="form-control" id="exclude_doc_ids" 
                                               placeholder="e.g., 70081311, 63164267">
                                        <div class="form-text">Comma-separated list of document IDs to exclude</div>
                                    </div>
                                </div>

                                <!-- Advanced Field Styling Options -->
                                <div class="mt-4">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">
                                            <i class="bi bi-palette me-2"></i>
                                            Field Styling Options
                                        </h6>
                                        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#stylingOptions" aria-expanded="false" aria-controls="stylingOptions">
                                            <i class="bi bi-chevron-down" id="stylingToggleIcon"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="collapse" id="stylingOptions">
                                    <div class="alert alert-info mb-3">
                                        <i class="bi bi-info-circle me-2"></i>
                                        <strong>Note:</strong> Advanced font styling is limited in client-side PDF generation. 
                                        Field dimensions and basic styling will be applied, but fonts may use PDF defaults.
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="field_width" class="form-label">
                                                <i class="bi bi-arrows-expand me-1"></i>
                                                Default Field Width
                                            </label>
                                            <input type="number" class="form-control" id="field_width" 
                                                   value="120" min="50" max="300" step="10">
                                            <div class="form-text">Default width in points (when DocuSign doesn't specify)</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="field_height" class="form-label">
                                                <i class="bi bi-arrows-expand-vertical me-1"></i>
                                                Default Field Height
                                            </label>
                                            <input type="number" class="form-control" id="field_height" 
                                                   value="20" min="10" max="50" step="2">
                                            <div class="form-text">Default height in points (when DocuSign doesn't specify)</div>
                                        </div>
                                    </div>

                                    <div class="row mt-3">
                                        <div class="col-md-12">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="show_field_names">
                                                <label class="form-check-label" for="show_field_names">
                                                    <i class="bi bi-tag me-1"></i>
                                                    Show Field Names
                                                </label>
                                                <div class="form-text">Display field names as placeholders</div>
                                            </div>
                                        </div>
                                    </div>


                                <div class="row mt-3">
                                    <div class="col-md-6">
                       <div class="form-check">
                           <input class="form-check-input" type="checkbox" id="include_system_tabs">
                           <label class="form-check-label" for="include_system_tabs">
                               <i class="bi bi-gear me-1"></i>
                               Include System Tabs
                           </label>
                           <div class="form-text">Include system-generated tabs (uncheck to filter out unwanted fields)</div>
                       </div>
                                    </div>
                                    <div class="col-md-6">
                       <div class="form-check">
                           <input class="form-check-input" type="checkbox" id="show_field_type_controls" checked>
                           <label class="form-check-label" for="show_field_type_controls">
                               <i class="bi bi-toggle-on me-1"></i>
                               Show Field Type Controls
                           </label>
                           <div class="form-text">Show advanced field type translation settings</div>
                       </div>
                                    </div>
                                </div>

                                <div id="field-type-controls-section" class="mt-3" style="display: none;">
                                    <div class="card">
                                        <div class="card-header">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0"><i class="bi bi-translate me-2"></i>Field Type Translation Settings</h6>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <button type="button" class="btn btn-outline-primary" id="enableAllFields">
                                                        <i class="bi bi-check-all me-1"></i>Enable All
                                                    </button>
                                                    <button type="button" class="btn btn-outline-secondary" id="disableAllFields">
                                                        <i class="bi bi-x-square me-1"></i>Disable All
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <p class="text-muted small mb-3">Enable/disable specific DocuSign field types for translation to PDF. Disabled field types will be skipped during conversion.</p>
                                            <div class="alert alert-info mb-3" id="field-status-alert" style="display: none;">
                                                <i class="bi bi-info-circle me-2"></i>
                                                <span id="field-status-text"></span>
                                            </div>
                                            <div id="field-type-controls" class="row">
                                                <!-- Field type controls will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
           </div>

                                    <!-- Field Type Information -->
                                    <div class="mt-4">
                                        <h6 class="mb-3">
                                            <i class="bi bi-info-circle me-2"></i>
                                            Field Type Conversion
                                        </h6>
                                        <div class="alert alert-success mb-3">
                                            <i class="bi bi-check-circle me-2"></i>
                                            <strong>Automatic Field Mapping:</strong> DocuSign fields are automatically converted to proper PDF AcroForm field types:
                                            <ul class="mb-0 mt-2">
                                                <li><strong>Signature/Initial fields</strong> → PDF Digital Signature fields</li>
                                                <li><strong>Date fields</strong> → PDF Date input fields with format validation</li>
                                                <li><strong>Text fields</strong> → PDF Text input fields</li>
                                                <li><strong>Checkbox fields</strong> → PDF Checkbox fields</li>
                                            </ul>
                                        </div>
                                    </div>
                                    </div> <!-- End collapse -->
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="text-center mt-4">
                                <button type="submit" class="btn btn-primary btn-lg" id="convertBtn">
                                    <i class="bi bi-magic me-2"></i>
                                    Convert to PDF
                                </button>
                                <div class="loading mt-3">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Converting...</span>
                                    </div>
                                    <p class="mt-2">Converting your file, please wait...</p>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Features Section -->
                <div class="row mt-5">
                    <div class="col-md-4">
                        <div class="card feature-card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-file-earmark-pdf fa-3x text-primary mb-3" style="font-size: 3rem;"></i>
                                <h5 class="card-title">Clean PDF Output</h5>
                                <p class="card-text">Converts DocuSign templates into professional, fillable PDFs with proper form fields.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card feature-card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-shield-lock fa-3x text-success mb-3" style="font-size: 3rem;"></i>
                                <h5 class="card-title">Privacy First</h5>
                                <p class="card-text">All processing happens in your browser. Your files never leave your device.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card feature-card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-arrow-repeat fa-3x text-warning mb-3" style="font-size: 3rem;"></i>
                                <h5 class="card-title">Seamless Transition</h5>
                                <p class="card-text">Easily migrate your existing DocuSign document templates to Adobe AcroForm format, preserving all your form fields and structure.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container text-center">
            <p class="mb-2">
                <i class="bi bi-code-slash me-2"></i>
                Built with JavaScript and PDF-lib | 
                <a href="https://github.com/KenGrinder/DocuSign-Convert" class="text-light">
                    <i class="bi bi-github me-1"></i>View on GitHub
                </a>
            </p>
            <p class="mb-0 small text-light">
                <i class="bi bi-shield-exclamation me-1"></i>
                <strong>Legal Disclaimer:</strong> This tool is not affiliated with, endorsed by, or sponsored by DocuSign or Adobe. 
                It processes user-exported JSON data to create standard PDF files. 
                Users are responsible for ensuring they have the right to convert their documents.
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/field-translators.js"></script>
    <script src="js/converter.js"></script>
    <script>
        // File upload handling
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const chooseFileBtn = document.getElementById('chooseFileBtn');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const uploadForm = document.getElementById('uploadForm');
        const convertBtn = document.getElementById('convertBtn');
        const loading = document.querySelector('.loading');
        const alertContainer = document.getElementById('alertContainer');

        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                showFileInfo(files[0]);
            }
        });

        // Button click handler (prevents event bubbling)
        chooseFileBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Prevent the upload area click from firing
            fileInput.click();
        });

        // Upload area click handler (only when not clicking the button)
        uploadArea.addEventListener('click', (e) => {
            // Only trigger if the click wasn't on the button
            if (e.target !== chooseFileBtn && !chooseFileBtn.contains(e.target)) {
                fileInput.click();
            }
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                showFileInfo(e.target.files[0]);
            }
        });

        // Collapsible styling options toggle
        const stylingToggle = document.querySelector('[data-bs-target="#stylingOptions"]');
        const stylingToggleIcon = document.getElementById('stylingToggleIcon');
        
        stylingToggle.addEventListener('click', () => {
            const isExpanded = stylingToggle.getAttribute('aria-expanded') === 'true';
            stylingToggleIcon.className = isExpanded ? 'bi bi-chevron-down' : 'bi bi-chevron-up';
        });

        function showFileInfo(file) {
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.style.display = 'block';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                <i class="bi bi-${type === 'danger' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
        }

        // Form submission
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const file = fileInput.files[0];
            if (!file) {
                showAlert('Please select a JSON file', 'danger');
                return;
            }

            convertBtn.style.display = 'none';
            loading.style.display = 'block';
            alertContainer.innerHTML = '';

            try {
                const text = await file.text();
                const jsonData = JSON.parse(text);
                
                const options = {
                    maskHeaderHeight: parseFloat(document.getElementById('mask_header_height').value) || 0,
                    maskFooterHeight: parseFloat(document.getElementById('mask_footer_height').value) || 0,
                    excludeDocIds: document.getElementById('exclude_doc_ids').value
                        .split(',')
                        .map(id => id.trim())
                        .filter(id => id.length > 0),
                    // Field styling options
                    fieldWidth: parseFloat(document.getElementById('field_width').value) || 120,
                    fieldHeight: parseFloat(document.getElementById('field_height').value) || 20,
                    showFieldNames: document.getElementById('show_field_names').checked,
                    includeSystemTabs: document.getElementById('include_system_tabs').checked
                    // Note: Signature and date fields are now always created as proper AcroForm field types
                    // No additional options needed for field type conversion
                };

                const pdfBytes = await convertDocuSignToPDF(jsonData, options);
                
                // Download the PDF
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = file.name.replace('.json', '_converted.pdf');
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showAlert('PDF converted successfully! Download started.', 'success');
                
            } catch (error) {
                console.error('Conversion error:', error);
                showAlert(`Conversion failed: ${error.message}`, 'danger');
            } finally {
                convertBtn.style.display = 'inline-block';
                loading.style.display = 'none';
            }
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize field type controls
            initializeFieldTypeControls();
            
            // Set up field type controls toggle
            document.getElementById('show_field_type_controls').addEventListener('change', function() {
                const section = document.getElementById('field-type-controls-section');
                section.style.display = this.checked ? 'block' : 'none';
            });
            
            // Show the controls by default if checked
            if (document.getElementById('show_field_type_controls').checked) {
                document.getElementById('field-type-controls-section').style.display = 'block';
            }
        });

        /**
         * Initialize field type controls based on available translators
         */
        function initializeFieldTypeControls() {
            const container = document.getElementById('field-type-controls');
            container.innerHTML = '';
            
            // Get field type configurations from the field-translators.js module
            // Use the actual field types if available, otherwise fall back to hardcoded list
            let fieldTypes = {};
            if (typeof getAllFieldTypeConfigs === 'function') {
                const configs = getAllFieldTypeConfigs();
                fieldTypes = Object.fromEntries(
                    Object.entries(configs).map(([key, config]) => [key, { 
                        name: config.name, 
                        description: config.description,
                        enabled: config.enabled 
                    }])
                );
            } else {
                // Fallback configuration if functions aren't loaded yet
                fieldTypes = {
                    'textTabs': { name: 'Text Fields', description: 'Single-line text input fields', enabled: true },
                    'signHereTabs': { name: 'Signature Fields', description: 'Adobe Fill & Sign signature fields', enabled: true },
                    'initialHereTabs': { name: 'Initial Fields', description: 'Adobe Fill & Sign fields for initials', enabled: true },
                    'checkboxTabs': { name: 'Checkbox Fields', description: 'Checkbox form controls', enabled: true },
                    'radioGroupTabs': { name: 'Radio Button Groups', description: 'Radio button groups', enabled: true },
                    'listTabs': { name: 'Dropdown Lists', description: 'Dropdown/combo box selections', enabled: true },
                    'fullNameTabs': { name: 'Full Name Fields', description: 'Auto-populated full name fields', enabled: true },
                    'dateSignedTabs': { name: 'Date Signed Fields', description: 'Auto-populated date fields', enabled: true },
                    'companyTabs': { name: 'Company Fields', description: 'Auto-populated company fields', enabled: true },
                    'titleTabs': { name: 'Title Fields', description: 'Auto-populated job title fields', enabled: true },
                    'emailAddressTabs': { name: 'Email Address Fields', description: 'Auto-populated email fields', enabled: true },
                    'numericalTabs': { name: 'Numerical Fields', description: 'Numeric input fields with validation', enabled: true },
                    'signerAttachmentTabs': { name: 'File Attachment Fields', description: 'File attachment fields for document uploads', enabled: true }
                };
            }
            
            Object.entries(fieldTypes).forEach(([fieldType, config]) => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4 mb-3';
                
                col.innerHTML = `
                    <div class="form-check">
                        <input class="form-check-input field-type-toggle" type="checkbox" id="${fieldType}" 
                               ${config.enabled ? 'checked' : ''} data-field-type="${fieldType}">
                        <label class="form-check-label" for="${fieldType}">
                            <strong>${config.name}</strong>
                            <br><small class="text-muted">${config.description}</small>
                        </label>
                    </div>
                `;
                
                container.appendChild(col);
            });
            
            // Add event listeners for field type toggles
            document.querySelectorAll('.field-type-toggle').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const fieldType = this.dataset.fieldType;
                    const enabled = this.checked;
                    
                    // Update the field translator system
                    if (typeof setFieldTypeEnabled === 'function') {
                        setFieldTypeEnabled(fieldType, enabled);
                        updateFieldStatusDisplay();
                    }
                    
                    console.log(`Field type ${fieldType} ${enabled ? 'enabled' : 'disabled'}`);
                });
            });
            
            // Add event listeners for bulk enable/disable buttons
            document.getElementById('enableAllFields').addEventListener('click', function() {
                document.querySelectorAll('.field-type-toggle').forEach(checkbox => {
                    checkbox.checked = true;
                    if (typeof setFieldTypeEnabled === 'function') {
                        setFieldTypeEnabled(checkbox.dataset.fieldType, true);
                    }
                });
                updateFieldStatusDisplay();
                console.log('All field types enabled');
            });
            
            document.getElementById('disableAllFields').addEventListener('click', function() {
                document.querySelectorAll('.field-type-toggle').forEach(checkbox => {
                    checkbox.checked = false;
                    if (typeof setFieldTypeEnabled === 'function') {
                        setFieldTypeEnabled(checkbox.dataset.fieldType, false);
                    }
                });
                updateFieldStatusDisplay();
                console.log('All field types disabled');
            });
            
            // Initialize status display
            updateFieldStatusDisplay();
        }
        
        /**
         * Update the field status display to show how many fields are enabled/disabled
         */
        function updateFieldStatusDisplay() {
            const statusAlert = document.getElementById('field-status-alert');
            const statusText = document.getElementById('field-status-text');
            
            if (!statusAlert || !statusText) return;
            
            const checkboxes = document.querySelectorAll('.field-type-toggle');
            const enabledCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            const totalCount = checkboxes.length;
            const disabledCount = totalCount - enabledCount;
            
            if (disabledCount === 0) {
                statusText.textContent = `All ${totalCount} field types are enabled. All DocuSign fields will be converted to PDF.`;
                statusAlert.className = 'alert alert-success mb-3';
            } else if (enabledCount === 0) {
                statusText.textContent = `All ${totalCount} field types are disabled. No DocuSign fields will be converted to PDF.`;
                statusAlert.className = 'alert alert-warning mb-3';
            } else {
                statusText.textContent = `${enabledCount} field types enabled, ${disabledCount} disabled. Only enabled field types will be converted to PDF.`;
                statusAlert.className = 'alert alert-info mb-3';
            }
            
            statusAlert.style.display = 'block';
        }
    </script>
</body>
</html>
